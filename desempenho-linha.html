<script>
function init(){
  Papa.parse(CSV_URL, {
    download: true,
    header: true,
    delimiter: "\t", // âœ… important: your CSV uses tabs
    skipEmptyLines: true,
    complete: (res)=>{
      const rows = res.data || [];
      rawRows = normalizeRows(rows);
      if (!rawRows.length){
        document.getElementById("cats-container").innerHTML = "<p>CSV sem dados.</p>";
        return;
      }
      monthKeys = computeMonthKeys(rawRows);
      minKey = monthKeys[0];
      maxKey = monthKeys[monthKeys.length-1];

      populatePeriodSelectors();
      buildCategoryCards("cats-container", CATEGORIES);
      applyFiltersAndRender();
    },
    error: (err)=> {
      document.getElementById("cats-container").innerHTML = "<p>Erro ao carregar CSV.</p>";
      console.error(err);
    }
  });

  applyBtn.addEventListener("click", applyFiltersAndRender);
  metricSel.addEventListener("change", applyFiltersAndRender);
  window.addEventListener("resize", ()=>{
    document.querySelectorAll(".card-wrap").forEach(w=>{
      if (w.style.maxHeight && w.style.maxHeight !== "0px"){
        w.style.maxHeight = w.scrollHeight + "px";
      }
    });
  });
}

init();
</script>
